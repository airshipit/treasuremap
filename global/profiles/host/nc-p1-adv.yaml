---
schema: drydock/HostProfile/v1
metadata:
  schema: metadata/Document/v1
  name: nc-p1-adv
  storagePolicy: cleartext
  labels:
    hosttype: nc-p1-adv
  layeringDefinition:
    abstract: false
    layer: global
  substitutions:
    - dest:
        path: .oob.credential
      src:
        schema: deckhand/Passphrase/v1
        name: ipmi_admin_password
        path: .
    - dest:
        - path: .platform.kernel_params.isolcpus
      src:
        schema: drydock/HardwareProfile/v1
        name: dell_r740_purley_adv_nc
        path: .cpu_sets.isolcpus
    - dest:
        - path: .platform.kernel_params.rcu_nocbs
      src:
        schema: drydock/HardwareProfile/v1
        name: dell_r740_purley_adv_nc
        path: .cpu_sets.rcu_nocbs
    - dest:
        path: .interfaces.p2p1.sriov.device
      src:
        schema: drydock/HardwareProfile/v1
        name: dell_r740_purley_adv_nc
        path: .device_aliases.dp_nic01
    - dest:
        path: .interfaces.p7p2.sriov.device.address
      src:
        schema: drydock/HardwareProfile/v1
        name: dell_r740_purley_adv_nc
        path: .device_aliases.dp_nic02.address
data:
  oob:
    type: 'ipmi'
    network: 'oob'
    account: 'tier4'
  primary_network: 'oam'
  hardware_profile: dell_r740_purley_adv_nc
  interfaces:
    pxe:
      device_link: pxe
      slaves:
        - 'pxe_nic01'
      networks:
        - 'pxe'
    bond1:
      device_link: bond1
      slaves:
        - 'gp_nic01'
        - 'gp_nic02'
      networks:
        - 'oam'
        - 'storage'
        - 'calico'
    p2p1:
      slaves:
        - 'dp_nic01'
      sriov:
        num_vfs: 32
        promisc: false
      ovs_dpdk:
        vf_index: 0
      pci_whitelist:
        trusted: false
    p7p2:
      slaves:
        - 'dp_nic02'
      sriov:
        num_vfs: 32
        promisc: false
      ovs_dpdk:
        vf_index: 0
      pci_whitelist:
        trusted: false
  storage:
    physical_devices:
      bootdisk:
        labels:
          bootdrive: 'true'
        partitions:
          - name: 'root'
            size: '30g'
            bootable: true
            filesystem:
              mountpoint: '/'
              fstype: 'ext4'
              mount_options: 'defaults'
          - name: 'boot'
            size: '1g'
            filesystem:
              mountpoint: '/boot'
              fstype: 'ext4'
              mount_options: 'defaults'
          - name: 'var_log'
            size: '100g'
            filesystem:
              mountpoint: '/var/log'
              fstype: 'ext4'
              mount_options: 'defaults'
          - name: 'var_crash'
            size: '70g'
            filesystem:
              mountpoint: '/var/crash'
              fstype: 'ext4'
              mount_options: 'defaults,nofail'
          - name: 'var'
            size: '>200g'
            filesystem:
              mountpoint: '/var'
              fstype: 'ext4'
              mount_options: 'defaults'
      ephemeral:
        partitions:
          - name: 'nova_instance'
            size: '99%'
            filesystem:
              mountpoint: '/var/lib/nova'
              fstype: 'ext4'
              mount_options: 'defaults'
  platform:
    image: 'bionic'
    kernel: 'ga-18.04'
    kernel_params:
      hugepagesz: 'hardwareprofile:hugepages.dpdk.size'
      hugepages: 'hardwareprofile:hugepages.dpdk.count'
      transparent_hugepage: 'never'
      kernel_package: 'linux-image-4.15.0-140-generic'
      console: 'ttyS0,115200n8 console=tty0'
      amd_iommu: 'on'
      intel_iommu: 'on'
      iommu: 'pt'
      cgroup_disable: 'hugetlb'
      default_hugepagesz: 'hardwareprofile:hugepages.dpdk.size'
      dpdk-socket-mem: '4096,4096'
      rcu_nocb_poll: true
  metadata:
    owner_data:
      hosttype: nc-p1-r740
      tenant-ceph-osd: enabled
      openstack-nova-compute: enabled
      openvswitch: enabled
      sriov: enabled
      openstack-libvirt: kernel
      beta.kubernetes.io/fluentd-ds-ready: 'true'
      node-exporter: enabled
      fluentd: enabled
...
