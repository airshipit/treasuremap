apiVersion: airshipit.org/v1alpha1
kind: ReplacementTransformer
metadata:
  name: vm-infra-bridge-replacements
  annotations:
    config.kubernetes.io/function: |-
      container:
        image: quay.io/airshipit/replacement-transformer:v2
replacements:
- source:
    objref:
      kind: VariableCatalogue
      name: vm-networking
    fieldref: spec.vm_infra_bridge.host_oam_interface
  target:
    objref:
      kind: KubeadmConfigTemplate
    fieldrefs:
      -  "spec.template.spec.files[path=/usr/bin/vm-infra-bridge.sh].content%REPLACEMENT_MGMT_INTF%"
- source:
    objref:
      kind: VariableCatalogue
      name: vm-networking
    fieldref: spec.vm_infra_bridge.vm_interface
  target:
    objref:
      kind: KubeadmConfigTemplate
    fieldrefs:
      -  "spec.template.spec.files[path=/usr/bin/vm-infra-bridge.sh].content%REPLACEMENT_VM_INFRA_INTF%"
- source:
    objref:
      kind: VariableCatalogue
      name: vm-networking
    fieldref: spec.vm_infra_bridge.vm_network
  target:
    objref:
      kind: KubeadmConfigTemplate
    fieldrefs:
      -  "spec.template.spec.files[path=/usr/bin/vm-infra-bridge.sh].content%REPLACEMENT_VM_NETWORK%"
- source:
    objref:
      kind: VariableCatalogue
      name: vm-networking
    fieldref: spec.vm_infra_bridge.vm_network_subnet_mask
  target:
    objref:
      kind: KubeadmConfigTemplate
    fieldrefs:
      -  "spec.template.spec.files[path=/usr/bin/vm-infra-bridge.sh].content%REPLACEMENT_VMNETWORK_SUBNET_MASK%"
